### TODO

我发现我在对LLama-3进LoRA微调时指定的微调模块如下: "q_proj,k_proj,v_proj,down_proj,up_proj" 时，在模型推理时随便输入一个text会遭遇报错说有两个Tensor shape不匹配，如果我对其所有模块进行LoRA微调则不会遇到这种报错，请问是我指定的模块不正确吗？


#### **1.1. Prompt-Based Finetuning 的关键**

1. **构造明确的 Prompt** ：在输入中嵌入任务相关的上下文信息，使模型更好地理解目标。

* **Example** :
  * Prompt: "请提供以下球员的总决赛场均数据。输入: {球员: 贾马尔-穆雷, 年份: 2023}"
  * 输出: "贾马尔-穆雷 在 2023 年 NBA 总决赛的场均数据如下: ..."

1. **统一格式和逻辑** ：使用标准化的输入和输出格式，减少模型学习的复杂度。
2. **减少参数改动** ：通过 LoRA 等方法仅优化少量权重（如偏置、部分层），避免对全模型进行大规模更新。

#### **1.3. 针对此场景的建议**

* **任务特点** ：你的任务主要关注于小规模数值型事实微调，数据稀疏且高精度要求。
* **建议参数设置** ：
* **lora_rank** ：
  * 建议值：`rank=16`
  * 原因：低秩表示的复杂度适中，能有效捕获具体数值细节。
* **lora_alpha** ：
  * 建议值：`alpha=16~32`
  * 原因：保证权重更新平稳，避免因数据量少导致模型偏差。

> 若实验结果不理想，可在 `rank=8~32` 和 `alpha=16~64` 间进行网格搜索优化。

#### **2.2. 如何在用户正常聊天形式下自动引导模型**

为了让用户能够以自然语言提问，同时利用 Prompt 提升模型准确率，可以引入 **系统层的提示模板** 或  **后台处理逻辑** (针对部分高精度需求的数据做mapping硬编码)。



**Question**

请你查看现在我的数据项中的input内容:

"""

"input": "请根据用户的问题和下方的背景知识，精准回答与问题中提到的NBA球员(用户的问题中提到的NBA球员名称可能是其中文全称，可能相较于中文全称会有字数上的不同、或某几个字是同音不同形的字，可能是简称，也可能是其外号。所以需要你仔细搜索你的知识库并仔细思考用户想问的究竟是哪一名球员)相关的数据。背景知识包括球员的NBA决赛场均数据。输出格式应严格按照如下规范：球员: {球员姓名} | {年龄: 数值岁} | {场均得分: 数值分} | {场均篮板: 数值个} | {场均助攻: 数值次} | {场均抢断: 数值次} | {场均盖帽: 数值次}。注意事项: 1. 如果问题涉及具体年份和总决赛场均数据，请确保回答内容与背景知识一致。 2. 请根据用户提问，从以下资源中检索并生成回答: 2.0'下方背景知识'  2.1 '背景知识（模型的内置知识）'  2.2 '你的记忆库（经过微调的知识）' 2.3'本地知识库系统（通过 RAG 实现的动态查询）'  。 如果检索上述资源后，仍无法找到足够的信息，请明确告知用户当前无法提供具体的数据，并建议用户尝试修改问题或查询其他来源。3. 对于涉及多个球员的数据提问，请你逐一列出并以同样格式回答。 4.如果用户问题没有涉及到具体的年份、没有涉及到总决赛、场均数据等字样，那么你不应该以下述形式回答用户，你不应该视用户试图问你NBA中xxx球员的xxx年的总决赛场均数据，经过了前面提及的背景信息源搜索过程后，如果都没有搜索到正确匹配的信息你就明确告知用户当前无法提供具体数据即可'",

"""

现在我对于整个chatbot的设计是这样的，我现在爬取了1990-2024年的NBA历年总决赛球员场均数据，我只准备用2020-2023这四年的数据对模型做LoRA微调，剩余年份的对应数据通过RAG来实现。所以我对于chatBot的预期行为是:

"""

模型先搜索记忆库(通过预训练的知识和LoRA微调得到的知识)，如果用户问的是2020-2024这几年的对应数据，那模型能直接回答，就不需要再走RAG了。如果搜索不到对应信息（或者说模型无法明确是否搜索到了正确的信息，因为有时模型会出现混淆），这种时候我应该如何设计才能让模型走RAG的路线来获取到正确信息呢？如果通过RAG还搜索不到对应的正确信息，又应该如何让模型输出对应的兜底回答呢？我不知道如何让整个路线如何顺利执行，如何驱动chatbot系统去执行这一条搜索链，毕竟模型本身只能做文本生成，无法自驱去完成这些操作。而且模型本身对于"能否搜索到正确信息，是否需要去执行下一条链，这个评判标准又是如何界定的呢？"我想知道在开发者的代码中应该去做哪些内容的设计，在模型SFT微调的过程中又应该在SFT QA对中包含哪些内容，如何让整个chatbot系统的数据搜索流程能按照我上述描述的那样去链式执行

"""


**Answer:**
